<div class="register-container">
  <!-- Toolbar -->
  <p-toolbar>
    <div class="p-toolbar-group-start" style="display: flex; align-items: center;">
      <i class="pi pi-user-plus"></i>
      <span class="register-title">
        Registrar Usuário
      </span>
    </div>
  </p-toolbar>

  <div class="register-card">
    <div class="form-container">
      <h2 class="form-title">Preencha os dados do novo usuário</h2>

      <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
        <div class="grid">
          <div class="col-12 md:col-6 field-container">
            <label for="name" class="required-field">Nome</label>
            <span class="p-input-icon-left">
              <i class="pi pi-user"></i>
              <input id="name" type="text" pInputText formControlName="name"
                    placeholder="Digite o nome completo"
                    [ngClass]="{'ng-invalid ng-dirty': formControls['name'].invalid && formControls['name'].touched}">
            </span>
            <small *ngIf="formControls['name'].invalid && formControls['name'].touched" class="error-message">
              <i class="pi pi-exclamation-circle"></i> Nome é obrigatório
            </small>
          </div>

          <div class="col-12 md:col-6 field-container">
            <label for="email" class="required-field">Email</label>
            <span class="p-input-icon-left">
              <i class="pi pi-envelope"></i>
              <input id="email" type="email" pInputText formControlName="email"
                    placeholder="Digite o email"
                    [ngClass]="{'ng-invalid ng-dirty': formControls['email'].invalid && formControls['email'].touched}">
            </span>
            <small *ngIf="formControls['email'].invalid && formControls['email'].touched" class="error-message">
              <i class="pi pi-exclamation-circle"></i> Email inválido
            </small>
          </div>

          <div class="col-12 md:col-6 field-container">
            <label for="password" class="required-field">Senha</label>
            <span class="p-input-icon-left">
              <i class="pi pi-lock"></i>
              <input id="password" type="password" pInputText formControlName="password"
                    placeholder="Digite uma senha segura"
                    [ngClass]="{'ng-invalid ng-dirty': formControls['password'].invalid && formControls['password'].touched}">
            </span>
            <small *ngIf="formControls['password'].invalid && formControls['password'].touched" class="error-message">
              <i class="pi pi-exclamation-circle"></i> A senha deve ter no mínimo 6 caracteres
            </small>
          </div>

          <div class="col-12 md:col-6 field-container">
            <label for="confirmPassword" class="required-field">Confirmar Senha</label>
            <span class="p-input-icon-left">
              <i class="pi pi-lock-open"></i>
              <input id="confirmPassword" type="password" pInputText formControlName="confirmPassword"
                    placeholder="Repita a senha"
                    [ngClass]="{'ng-invalid ng-dirty': formControls['confirmPassword'].invalid && formControls['confirmPassword'].touched ||
                                userForm.hasError('mismatch')}">
            </span>
            <small *ngIf="formControls['confirmPassword'].invalid && formControls['confirmPassword'].touched" class="error-message">
              <i class="pi pi-exclamation-circle"></i> Confirmação de senha é obrigatória
            </small>
            <small *ngIf="userForm.hasError('mismatch')" class="error-message">
              <i class="pi pi-exclamation-circle"></i> As senhas não coincidem
            </small>
          </div>

          <div class="col-12 field-container">
            <label for="role" class="required-field">Tipo de Usuário</label>
            <p-dropdown id="role" [options]="roles" formControlName="role"
                      optionLabel="label" optionValue="value"
                      placeholder="Selecione o tipo de usuário">
              <ng-template pTemplate="selectedItem">
                <div class="flex align-items-center gap-2" *ngIf="userForm.get('role')?.value">
                  <i class="pi" [ngClass]="userForm.get('role')?.value === 'ADMIN' ? 'pi-shield' : 'pi-user'"></i>
                  <div>{{ userForm.get('role')?.value === 'ADMIN' ? 'Administrador' : 'Usuário' }}</div>
                </div>
              </ng-template>
              <ng-template let-item pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <i class="pi" [ngClass]="item.value === 'ADMIN' ? 'pi-shield' : 'pi-user'"></i>
                  <div>{{item.label}}</div>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>

        <div class="submit-button-container">
          <p-button type="button" label="Cancelar" icon="pi pi-times" styleClass="p-button-text"
                   [style]="{'margin-right': '1rem'}" (onClick)="resetForm()"></p-button>
          <p-button type="submit" label="Cadastrar Usuário" icon="pi pi-save"
                   [loading]="loading" styleClass="p-button-primary"></p-button>
        </div>
      </form>
    </div>
  </div>
</div>

<p-toast position="bottom-right"></p-toast>
